<app-state-section [state]="sectionState">
  <div class="card shadow-sm p-4">
    <div  class="d-flex justify-content-between align-items-center">
      <h3 class="text-center mb-4">Invoice List</h3>

      <p-button *grantAccess="RolesConstants.ADD_EDIT_INVOICE_STUDENT" (onClick)="openInvoiceDialog()" text label="Add Invoice" icon="pi pi-receipt" />
    </div>
    <p-table [value]="invoices" class="p-datatable-striped"  [lazy]="true" [paginator]="true" [rows]="pageSize"
    [totalRecords]="totalRowsCount" (onLazyLoad)="paginate($event)" [rowsPerPageOptions]="rowsPerPageOptions"
    responsiveLayout="scroll" >
      <ng-template pTemplate="header">
        <tr>
          <th>student Name</th>
          <th>Parent Name</th>
          <th>Media</th>
          <th>Created At</th>
          <th>Updated At</th>
          <th *grantAccess="RolesConstants.ADD_EDIT_INVOICE_STUDENT">Actions</th>
        </tr>
      </ng-template>

      <ng-template let-invoice pTemplate="body">
        <tr>
          <td>{{ invoice.student.studentName }}</td>
          <td>{{ invoice.parent.parentName }}</td>

          <!-- Media Attachment -->
          <td>
            <ng-container *ngIf="invoice.media; else noMedia">
              <img (click)="openMediaDialog(invoice.media)" [src]="invoice.media" alt="Invoice Media" class="img-fluid cursor-pointer" width="100" height="100" />
            </ng-container>
            <ng-template #noMedia>
              <span>No media available</span>
            </ng-template>
          </td>

          <!-- Created At -->
          <td>{{ invoice.createdAt | date}}</td>

          <!-- Updated At -->
          <td>{{ invoice.updatedAt | date }}</td>

          <!-- Actions -->
          <td *grantAccess="RolesConstants.ADD_EDIT_INVOICE_STUDENT">
            <button pButton type="button" label="Edit" icon="pi pi-pencil" class="p-button-sm p-button-warning"
              (click)="editInvoice(invoice)"></button>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="6">No invoices found.</td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</app-state-section>
